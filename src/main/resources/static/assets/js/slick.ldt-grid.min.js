var grid,s;var loader=new Slick.Data.RemoteModel(apicall);var options={editable:true,enableAddRow:true,enableCellNavigation:true,asyncEditorLoading:false,autoEdit:false};var loadingIndicator=null;var savingIndicator=null;$(function(){grid=new Slick.Grid("#myGrid",loader.data,columns,options);grid.onViewportChanged.subscribe(function(c,b){var a=grid.getViewport();loader.ensureData(a.top,a.bottom)});grid.onSort.subscribe(function(c,b){loader.setSort(b.sortCol.field,b.sortAsc?1:-1);var a=grid.getViewport();loader.ensureData(a.top,a.bottom)});grid.onCellChange.subscribe(function(b,a){if(a.item["#"]==0){a.item["#"]=2}loader.updateRow(a.row,templateItem,fragments);grid.invalidateRow(a.row);grid.render()});grid.onClick.subscribe(function(b,a){if(a.cell==0){grid.setActiveCell(a.row,1,false,false,true);grid.getSelectionModel().setSelectedRanges([new Slick.Range(a.row,1,a.row,grid.getColumns().length-1)])}});grid.onKeyDown.subscribe(function(b,a){if(b.which==46){ranges=grid.getSelectionModel().getSelectedRanges();if(ranges.length==1){if(ranges[0].fromRow==ranges[0].toRow&&ranges[0].fromCell==1&&ranges[0].toCell==grid.getColumns().length-1){loader.removeRow(ranges[0].fromRow,1);grid.invalidate();grid.getSelectionModel().setSelectedRanges([]);b.preventDefault();b.stopPropagation()}}}});loader.onDataLoading.subscribe(function(){if(!loadingIndicator){loadingIndicator=$("<span class='loading-indicator'><label>Loading...</label></span>").appendTo(document.body);var a=$("#myGrid");loadingIndicator.css("position","absolute").css("top",a.position().top+a.height()/2-loadingIndicator.height()/2).css("left",a.position().left+a.width()/2-loadingIndicator.width()/2)}loadingIndicator.show()});loader.onDataLoaded.subscribe(function(c,a){for(var b=a.from;b<=a.to;b++){grid.invalidateRow(b)}grid.updateRowCount();grid.render();loadingIndicator.fadeOut()});loader.onDataSaving.subscribe(function(){if(!savingIndicator){savingIndicator=$("<span class='loading-indicator'><label>Saving...</label></span>").appendTo(document.body);var a=$("#myGrid");savingIndicator.css("position","absolute").css("top",a.position().top+a.height()/2-savingIndicator.height()/2).css("left",a.position().left+a.width()/2-savingIndicator.width()/2)}savingIndicator.show()});loader.onDataSaved.subscribe(function(b,a){savingIndicator.fadeOut()});$("#txtSearch").keyup(function(b){if(b.which==13){loader.setSearch($(this).val());var a=grid.getViewport();loader.ensureData(a.top,a.bottom)}});loader.setSearch($("#txtSearch").val());loader.setSort("score",-1);grid.setSortColumn("score",false);grid.onViewportChanged.notify();grid.setSelectionModel(new Slick.CellSelectionModel());grid.onAddNewRow.subscribe(function(b,a){loader.addRow(grid,a.item,defaultItem)})});